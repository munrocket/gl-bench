'use strict';var GLBench=function(){class l{constructor(a,b={}){this.css="#gl-bench { position:absolute; left:0; top:0; z-index:1000; -webkit-user-select: none; -moz-user-select: none; user-select: none; }  #gl-bench div { position: relative; display: block; margin: 4px; padding: 0 7px 0 10px; background: #6c6; border-radius: 15px; cursor: pointer; opacity: 0.9; }  #gl-bench svg { height: 60px; margin: 0 -1px; }  #gl-bench text { font-size: 12px; font-family: Helvetica,Arial,sans-serif; font-weight: 700; dominant-baseline: middle; text-anchor: middle; }  #gl-bench .gl-mem { font-size: 9px; }  #gl-bench line { stroke-width: 5; stroke: #112211; stroke-linecap: round; }  #gl-bench polyline { fill: none; stroke: #112211; stroke-linecap: round; stroke-linejoin: round; stroke-width: 3.5; }  #gl-bench rect { fill: #448844; }  #gl-bench .opacity { stroke: #448844; } ";
this.svg='<div class="gl-box"> <svg viewBox="0 0 55 60"> <text x="27" y="56" class="gl-fps">00 FPS</text> <text x="28" y="8" class="gl-mem"></text> <rect x="0" y="14" rx="4" ry="4" width="55" height="32"></rect> <polyline class="gl-chart"></polyline> </svg> <svg viewBox="0 0 14 60" class="gl-cpu-svg"> <line x1="7" y1="38" x2="7" y2="11" class="opacity"/> <line x1="7" y1="38" x2="7" y2="11" class="gl-cpu" stroke-dasharray="0 27"/> <path d="M5.35 43c-.464 0-.812.377-.812.812v1.16c-.783.1972-1.421.812-1.595 1.624h-1.16c-.435 0-.812.348-.812.812s.348.812.812.812h1.102v1.653H1.812c-.464 0-.812.377-.812.812 0 .464.377.812.812.812h1.131c.1943.783.812 1.392 1.595 1.595v1.131c0 .464.377.812.812.812.464 0 .812-.377.812-.812V53.15h1.653v1.073c0 .464.377.812.812.812.464 0 .812-.377.812-.812v-1.131c.783-.1943 1.392-.812 1.595-1.595h1.131c.464 0 .812-.377.812-.812 0-.464-.377-.812-.812-.812h-1.073V48.22h1.102c.435 0 .812-.348.812-.812s-.348-.812-.812-.812h-1.16c-.1885-.783-.812-1.421-1.595-1.624v-1.131c0-.464-.377-.812-.812-.812-.464 0-.812.377-.812.812v1.073H6.162v-1.073c0-.464-.377-.812-.812-.812zm.58 3.48h2.088c.754 0 1.363.609 1.363 1.363v2.088c0 .754-.609 1.363-1.363 1.363H5.93c-.754 0-1.363-.609-1.363-1.363v-2.088c0-.754.609-1.363 1.363-1.363z"/> </svg> <svg viewBox="0 0 14 60" class="gl-gpu-svg"> <line x1="7" y1="38" x2="7" y2="11" class="opacity"/> <line x1="7" y1="38" x2="7" y2="11" class="gl-gpu" stroke-dasharray="0 27"/> <path d="M1.94775 43.3772a.736.736 0 10-.00416 1.472c.58535.00231.56465.1288.6348.3197.07015.18975.04933.43585.04933.43585l-.00653.05405v8.671a.736.736 0 101.472 0v-1.4145c.253.09522.52785.1495.81765.1495h5.267c1.2535 0 2.254-.9752 2.254-2.185v-3.105c0-1.2075-1.00625-2.185-2.254-2.185h-5.267c-.28865 0-.5635.05405-.8165.1495.01806-.16445.04209-.598-.1357-1.0787-.22425-.6072-.9499-1.2765-2.0125-1.2765zm2.9095 3.6455c.42435 0 .7659.36225.7659.8119v2.9785c0 .44965-.34155.8119-.7659.8119s-.7659-.36225-.7659-.8119v-2.9785c0-.44965.34155-.8119.7659-.8119zm4.117 0a2.3 2.3 0 012.3 2.3 2.3 2.3 0 01-2.3 2.3 2.3 2.3 0 01-2.3-2.3 2.3 2.3 0 012.3-2.3z"/> </svg> </div>';
this.paramLogger=()=>{};this.chartLogger=()=>{};this.chartHz=this.chartLen=20;this.names=[];this.cpuAccums=[];this.gpuAccums=[];this.activeAccums=[];this.chart=Array(this.chartLen);this.now=()=>performance&&performance.now?performance.now():Date.now();this.updateUI=()=>{[].forEach.call(this.nodes["gl-gpu-svg"],a=>{a.style.display=this.trackGPU?"inline":"none"})};Object.assign(this,b);this.detected=0;this.finished=[];this.frameId=this.isFramebuffer=0;let e,c=0,f,g=a=>{10>++c?e=requestAnimationFrame(g):
(this.detected=Math.ceil(1E3*c/(a-f)/70),cancelAnimationFrame(e));f||(f=a)};requestAnimationFrame(g);if(a){let b=async(b,c)=>Promise.resolve(setTimeout(()=>{a.getError();const d=this.now()-b;c.forEach((a,b)=>{a&&(this.gpuAccums[b]+=d)})},0)),c=(a,c,d)=>function(){const n=c.now();a.apply(d,arguments);c.trackGPU&&c.finished.push(b(n,c.activeAccums.slice(0)))};"drawArrays drawElements drawArraysInstanced drawBuffers drawElementsInstanced drawRangeElements".split(" ").forEach(b=>{a[b]&&(a[b]=c(a[b],this,
a))});a.getExtension=((b,f)=>function(){let d=b.apply(a,arguments);d&&["drawElementsInstancedANGLE","drawBuffersWEBGL"].forEach(a=>{d[a]&&(d[a]=c(d[a],f,d))});return d})(a.getExtension,this)}this.withoutUI||(this.dom||(this.dom=document.body),b=document.createElement("div"),b.id="gl-bench",this.dom.appendChild(b),this.dom.insertAdjacentHTML("afterbegin",'<style id="gl-bench-style">'+this.css+"</style>"),this.dom=b,this.dom.addEventListener("click",()=>{this.trackGPU=!this.trackGPU;this.updateUI()}),
this.paramLogger=((a,b,c)=>{let f="gl-cpu gl-gpu gl-mem gl-fps gl-gpu-svg gl-chart".split(" "),d=Object.assign({},f);f.forEach(a=>d[a]=b.getElementsByClassName(a));this.nodes=d;return(b,f,e,h,k,g,m)=>{d["gl-cpu"][b].style.strokeDasharray=(.27*f).toFixed(0)+" 100";d["gl-gpu"][b].style.strokeDasharray=(.27*e).toFixed(0)+" 100";d["gl-mem"][b].innerHTML=c[b]?c[b]:h?"mem: "+h.toFixed(0)+"mb":"";d["gl-fps"][b].innerHTML=k.toFixed(0)+" FPS";a(c[b],f,e,h,k,g,m)}})(this.paramLogger,this.dom,this.names),this.chartLogger=
((a,b)=>{let c={"gl-chart":b.getElementsByClassName("gl-chart")};return(b,d,f)=>{let e="",g=d.length;for(let a=0;a<g;a++){let b=(f+a+1)%g;void 0!=d[b]&&(e=e+" "+(55*a/(g-1)).toFixed(1)+","+(45-22*d[b]/60/this.detected).toFixed(1))}c["gl-chart"][b].setAttribute("points",e);a(this.names[b],d,f)}})(this.chartLogger,this.dom))}addUI(a){-1==this.names.indexOf(a)&&(this.names.push(a),this.dom&&(this.dom.insertAdjacentHTML("beforeend",this.svg),this.updateUI()),this.cpuAccums.push(0),this.gpuAccums.push(0),
this.activeAccums.push(!1))}nextFrame(a){this.frameId++;a=a?a:this.now();if(1>=this.frameId)this.paramFrame=this.frameId,this.paramTime=a;else{var b=a-this.paramTime;if(1E3<=b){var e=this.frameId-this.paramFrame,c=e/b*1E3;for(let a=0;a<this.names.length;a++)this.paramLogger(a,this.cpuAccums[a]/b*100,this.gpuAccums[a]/b*100,performance&&performance.memory?performance.memory.usedJSHeapSize/1048576:0,c,b,e),this.cpuAccums[a]=0,Promise.all(this.finished).then(()=>{this.gpuAccums[a]=0;this.finished=[]});
this.paramFrame=this.frameId;this.paramTime=a}}if(this.detected&&this.chartFrame)for(b=a-this.chartTime,e=this.chartHz*b/1E3;0<--e&&this.detected;){this.chart[this.circularId%this.chartLen]=(this.frameId-this.chartFrame)/b*1E3;for(c=0;c<this.names.length;c++)this.chartLogger(c,this.chart,this.circularId);this.circularId++;this.chartFrame=this.frameId;this.chartTime=a}else this.chartFrame=this.frameId,this.chartTime=a,this.circularId=0}begin(a){this.updateAccums(a)}end(a){this.updateAccums(a)}updateAccums(a){let b=
this.names.indexOf(a);-1==b&&(b=this.names.length,this.addUI(a));a=this.now();let e=a-this.t0;for(let a=0;a<b+1;a++)this.activeAccums[a]&&(this.cpuAccums[a]+=e);this.activeAccums[b]=!this.activeAccums[b];this.t0=a}}return l}();

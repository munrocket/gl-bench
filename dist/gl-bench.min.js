'use strict';var GlBench=function(){class f{constructor(a,b,c,e){this.fpsLogger=a;this.counterLogger=b;this.gl=c;this.ext=e}update(){if(void 0===this.gpuFrames)this.queries=[this.gl.createQuery()],this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queries[0]),this.gpuFrames=0,this.nanosecs=[],this.duration=0;else{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT);if(!this.gl.getParameter(this.ext.GPU_DISJOINT_EXT))for(let b=this.gpuFrames;b<this.queries.length&&this.gl.getQueryParameter(this.queries[b],this.gl.QUERY_RESULT_AVAILABLE);b++){this.gpuFrames++;
var a=this.gl.getQueryParameter(this.queries[b],this.gl.QUERY_RESULT);this.nanosecs.push(a);this.duration+=a;a=this.duration/1E9;if(1<=a){let c=this.gpuFrames/a;for(;1<=a;)this.fpsLogger(c),a--;for(a=0;a<b+1;a++)this.gl.deleteQuery(this.queries[a]);this.queries.splice(0,b+1);this.nanosecs.splice(0,b+1);this.duration=this.gpuFrames=0}}this.queries.push(this.gl.createQuery());this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queries[this.queries.length-1])}}begin(){void 0===this.startCounter&&(this.startCounter=
[],this.finishCounter=[]);this.startCounter.push(this.gl.createQuery());this.finishCounter.push(this.gl.createQuery());this.ext.queryCounterEXT(this.startCounter[this.startCounter.length-1],this.ext.TIMESTAMP_EXT)}end(){this.ext.queryCounterEXT(this.finishCounter[this.finishCounter.length-1],this.ext.TIMESTAMP_EXT)}calcCounter(a){let b=a=0;if(!this.gl.getParameter(this.ext.GPU_DISJOINT_EXT))for(let d=0,f=Math.min(this.startCounter.length,this.finishCounter.length);d<f;d++){var c=this.gl.getQueryParameter(this.startCounter[d],
this.gl.QUERY_RESULT_AVAILABLE),e=this.gl.getQueryParameter(this.finishCounter[d],this.gl.QUERY_RESULT_AVAILABLE);console.log(c,e);c&&e&&(c=this.gl.getQueryParameter(this.startCounter[d],this.gl.QUERY_RESULT),e=this.gl.getQueryParameter(this.finishCounter[d],this.gl.QUERY_RESULT),a+=(e-c)/1E9,b+=this.nanosecs[d])}0!=b&&this.counterLogger(a/b)}}class g{constructor(a,b){this.fpsLogger=a;this.counterLogger=b}now(){return"undefined"!=typeof performance?performance.now():Date.now()}update(){if(void 0===
this.frames)this.frames=0,this.prevTime=this.now();else{this.frames++;let a=this.now();this.ms=a-this.prevTime;let b=this.ms/1E3;if(1<=b){let c=this.frames/b;for(;1<=b;)this.fpsLogger(c),b--;this.frames=0;this.prevTime=a}}}begin(){this.counterBegin=this.now()}end(){void 0===this.prevframes?this.counterDuration=0:0===this.frames?(this.counterLogger(this.counterDuration/this.ms),this.counterDuration=0):this.counterDuration+=this.now()-this.counterBegin;this.prevframes=this.frames}}class h{constructor(a,
b){this.fpsLogger=a;this.counterLogger=b}initCanvas(a){if(!a){let b=document.getElementsByTagName("canvas");for(let c=0;c<b.length;c++)if(0==c||a.width*a.height<b[c].width*b[c].height)a=b[c]}if(a&&"function"==typeof a.getContext){let b=a.getContext("webgl")||a.getContext("experimental-webgl");if(b){if("ANGLE_instanced_arrays EXT_blend_minmax EXT_color_buffer_half_float EXT_disjoint_timer_query EXT_float_blend EXT_frag_depth EXT_shader_texture_lod EXT_texture_filter_anisotropic WEBKIT_EXT_texture_filter_anisotropic EXT_sRGB OES_element_index_uint OES_standard_derivatives OES_texture_float OES_texture_float_linear OES_texture_half_float OES_texture_half_float_linear OES_vertex_array_object WEBGL_color_buffer_float WEBGL_compressed_texture_s3tc WEBKIT_WEBGL_compressed_texture_s3tc WEBGL_compressed_texture_s3tc_srgb WEBGL_debug_renderer_info WEBGL_debug_shaders WEBGL_depth_texture WEBKIT_WEBGL_depth_texture WEBGL_draw_buffers WEBGL_lose_context WEBKIT_WEBGL_lose_context WEBGL_multi_draw WEBGL_multi_draw_instanced WEBGL_video_texture".split(" ").forEach(a=>
{b.getExtension(a)||console.log(a)}),a=b.getExtension("EXT_disjoint_timer_query"))b.createQuery=a.createQueryEXT.bind(a),b.deleteQuery=a.deleteQueryEXT.bind(a),b.beginQuery=a.beginQueryEXT.bind(a),b.endQuery=a.endQueryEXT.bind(a),b.getQueryParameter=a.getQueryObjectEXT.bind(a),b.QUERY_RESULT_AVAILABLE=a.QUERY_RESULT_AVAILABLE_EXT,b.QUERY_RESULT=a.QUERY_RESULT_EXT,this.gpu=new f(this.fpsLogger,this.counterLogger,b,a)}else if(b=a.getContext("webgl2"),"EXT_color_buffer_float EXT_disjoint_timer_query_webgl2 EXT_float_blend EXT_texture_filter_anisotropic OES_texture_float_linear WEBGL_compressed_texture_s3tc WEBGL_compressed_texture_s3tc_srgb WEBGL_debug_renderer_info WEBGL_debug_shaders WEBGL_lose_context WEBGL_multi_draw WEBGL_multi_draw_instanced WEBGL_video_texture".split(" ").forEach(a=>
{b.getExtension(a)||console.log("2"+a)}),a=b?b.getExtension("EXT_disjoint_timer_query_webgl2"):null)this.gpu=new f(this.fpsLogger,this.counterLogger,b,a);this.gl=b}this.cpu=new g(this.fpsLogger,this.counterLogger)}update(){this.gpu?this.gpu.update():this.cpu?this.cpu.update():(this.initCanvas(),this.update())}begin(){this.ext?this.gpu.begin():this.cpu?this.cpu.begin():(this.initCanvas(),this.begin())}end(){this.ext?this.gpu.end():this.cpu&&this.cpu.end()}}return h}();
